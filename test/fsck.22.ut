## -*- shell-script -*-

TOOL=ute
INFILE="${srcdir}/fsck.17.ref.leute"
OUTFILE=$(mktemp "/tmp/tmp.XXXXXXXX")
COMMENT="testing in situ decompression of compressed data"
CMDFILE=$(mktemp "/tmp/tmp.XXXXXXXX")

if test "${endian}" = "big"; then
	INFILE="${srcdir}/fsck.17.ref.beute"
	REFFILE=$(mktemp "/tmp/tmp.XXXXXXXX")
elif test "${endian}" = "little"; then
	INFILE="${srcdir}/fsck.17.ref.leute"
	REFFILE="${srcdir}/mux.7.ref.ute"
fi

cat <<EOF > "${CMDFILE}"
if test "${endian}" = "big"; then
	"\${TOOL}" fsck --big-endian "${srcdir}/mux.7.ref.ute" -o '${REFFILE}'
fi
cp -d '${INFILE}' '${OUTFILE}'
"\${TOOL}" fsck --decompress '${OUTFILE}'
## truncate and overwrite ftr fields
dd if='/dev/zero' of='${OUTFILE}' ibs=4 obs=4 seek=6 count=2 conv=notrunc
head -c -16 '${OUTFILE}' > '${OUTFILE}.tmp'
mv '${OUTFILE}.tmp' '${OUTFILE}'
EOF

## fsck.22.ut ends here
